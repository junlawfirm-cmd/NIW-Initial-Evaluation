<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NIW ì´ë‹ˆì…œ í‰ê°€ ë¶„ì„í‘œ(ê´€ë¦¬ì) | Law Office of Hong-min Jun</title>
  <meta name="description" content="NIW ì´ë‹ˆì…œ í‰ê°€ ë¶„ì„í‘œ ê´€ë¦¬ììš©(ì¼€ì´ìŠ¤ ë°œí–‰) - Law Office of Hong-min Jun" />
  <style>
    :root{
      --bg:#ffffff;
      --panel:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:rgba(17,24,39,.12);

      --primary:#5b8cff;   /* pastel blue */
      --primary2:#3d6df2;
      --accent:#f5d18a;    /* pastel gold */
      --accent2:#e8b65e;

      --ok:#16a34a;
      --warn:#d97706;
      --danger:#dc2626;

      --shadow: 0 12px 36px rgba(17,24,39,.10);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background: var(--bg);
      color:var(--text);
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1120px; margin:0 auto; padding:0 18px}

    header{padding:18px 0 10px}
    .brandbar{
      display:flex; align-items:flex-start; justify-content:space-between;
      gap:14px; flex-wrap:wrap;
      padding:14px 16px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.92);
      border-radius:20px;
      box-shadow: var(--shadow);
    }
    .brand-left{display:flex; align-items:flex-start; gap:12px; min-width: 260px;}
    .brand-title{display:flex; flex-direction:column; gap:3px}
    .brand-title .name{font-weight:950; letter-spacing:-.2px; font-size:16px; line-height:1.2}
    .brand-title .motto{color:var(--muted); font-size:12.5px; line-height:1.25}
    .brand-title .licenses{color:rgba(17,24,39,.70); font-size:12px; line-height:1.25}
    .brand-right{display:flex; align-items:center; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .contact-pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(17,24,39,.03);
      color:rgba(17,24,39,.78);
      font-size:12px; white-space:nowrap;
    }
    .contact-pill strong{color:var(--text)}
    .contact-pill .dot{
      width:6px; height:6px; border-radius:50%;
      background: var(--accent2);
      box-shadow:0 0 0 5px rgba(232,182,94,.18);
    }

    .pagehead{padding:14px 0 6px}
    h1{margin:0; font-size:22px; letter-spacing:-.4px}
    .subtitle{
      margin-top:6px;
      color:rgba(17,24,39,.70);
      font-size:13px; line-height:1.45; max-width: 980px;
    }

    .formrow{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media (min-width: 980px){
      .formrow{grid-template-columns: 1.2fr 1.2fr 1fr;}
    }
    .field{
      display:flex; flex-direction:column; gap:6px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background:rgba(17,24,39,.02);
    }
    .field label{
      font-size:12px;
      color:rgba(17,24,39,.72);
      font-weight:900;
      letter-spacing:-.1px;
    }
    .field input{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(17,24,39,.15);
      background:#fff;
      color:var(--text);
      outline:none;
      font-size:13px;
    }
    .field input::placeholder{color:rgba(17,24,39,.40)}
    .hint{margin-top:6px; font-size:12px; color:rgba(17,24,39,.55)}
    .hint strong{color:rgba(17,24,39,.82)}

    .topbar{
      margin-top:12px;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px; border-radius:999px;
      border:1px solid var(--border);
      background:rgba(17,24,39,.02);
      color:rgba(17,24,39,.72);
      font-size:12px;
    }
    .pill strong{color:var(--text)}
    .status{display:inline-flex; align-items:center; gap:8px; font-weight:950; color:var(--text)}
    .status-dot{
      width:10px; height:10px; border-radius:50%;
      background: var(--warn);
      box-shadow:0 0 0 5px rgba(217,119,6,.14);
    }
    .status-dot.ok{background:var(--ok); box-shadow:0 0 0 5px rgba(22,163,74,.14)}
    .status-dot.bad{background:var(--danger); box-shadow:0 0 0 5px rgba(220,38,38,.14)}

    .btn{
      cursor:pointer;
      border:1px solid rgba(17,24,39,.15);
      background:#fff;
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-weight:900;
      font-size:13px;
      transition:.15s;
      box-shadow: 0 10px 24px rgba(17,24,39,.07);
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{
      background:linear-gradient(180deg, rgba(91,140,255,.95), rgba(61,109,242,.88));
      border-color:rgba(61,109,242,.35);
      color:#fff;
    }
    .btn.gold{
      background:linear-gradient(180deg, rgba(245,209,138,.98), rgba(232,182,94,.92));
      border-color:rgba(232,182,94,.45);
      color:#111827;
    }
    .btn.danger{
      background:linear-gradient(180deg, rgba(239,68,68,.95), rgba(220,38,38,.88));
      border-color:rgba(220,38,38,.35);
      color:#fff;
    }

    main{padding:10px 0 44px}

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 980px){
      .grid{grid-template-columns: 1fr 1fr;}
    }

    .card{
      background:#fff;
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:14px 14px 12px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0 0 10px;
      font-size:15px;
      letter-spacing:-.1px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .score{
      color:rgba(17,24,39,.70);
      font-size:12px;
      font-weight:900;
      border:1px solid var(--border);
      background:rgba(17,24,39,.02);
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    /* table layout ê°œì„ (ë¹ˆì¹¸ ì¤„ì´ê³ , ë©”ëª¨ í­ ì•ˆì •í™”) */
    table{width:100%; border-collapse:collapse; font-size:13px; table-layout:fixed}
    th,td{
      padding:10px 8px;
      border-top:1px solid rgba(17,24,39,.08);
      vertical-align:top;
    }
    th{
      text-align:left;
      color:rgba(17,24,39,.60);
      font-weight:900;
    }
    th:nth-child(1), td:nth-child(1){width:44%;}
    th:nth-child(2), td:nth-child(2){width:72px;}
    th:nth-child(3), td:nth-child(3){width:auto;}
    td:nth-child(3){color:rgba(17,24,39,.78)}
    input[type="checkbox"]{
      width:18px; height:18px;
      accent-color: var(--primary2);
      transform: translateY(2px);
      cursor:pointer;
    }

    /* Summary ì˜ì—­ ê³µë°± ì¤„ì´ê³  ì•ˆì •í™” */
    .summary{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-bottom:12px;
      align-items:start;
    }
    @media (min-width: 980px){
      .summary{grid-template-columns: 1.35fr .65fr;}
    }
    .kpi{display:flex; gap:10px; flex-wrap:wrap; margin-top:8px}
    .result{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(17,24,39,.02);
      line-height:1.5;
      color:rgba(17,24,39,.80);
      font-size:13px;
    }
    textarea{
      width:100%;
      min-height:88px;
      border-radius:14px;
      border:1px solid rgba(17,24,39,.15);
      background:#fff;
      color:var(--text);
      padding:10px;
      font-size:13px;
      line-height:1.45;
      outline:none;
    }
    textarea::placeholder{color:rgba(17,24,39,.45)}
    .tiny{font-size:11.5px; color:rgba(17,24,39,.55)}
    .divider{height:1px; background:rgba(17,24,39,.08); margin:10px 0}
    .tag{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(17,24,39,.02);
      color:rgba(17,24,39,.70);
      font-size:11px;
      font-weight:800;
    }

    /* paid blocks */
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(91,140,255,.30);
      background:rgba(91,140,255,.10);
      color:rgba(17,24,39,.85);
      font-size:12px;
      font-weight:950;
      margin-top:2px;
    }
    .paid{
      border-radius:14px;
      border:1px dashed rgba(232,182,94,.70);
      background:rgba(245,209,138,.18);
      padding:14px 16px; /* ë©”ëª¨ ì¢Œìš° ì—¬ë°± ë„“í˜ */
      margin-top:10px;
      color:rgba(17,24,39,.92);
      font-size:13px;
      line-height:1.6;
      word-break:break-word;
    }

    /* ëª¨ë‹¬ */
    .modal{
      position:fixed; inset:0; display:none;
      align-items:center; justify-content:center;
      padding:16px;
      background:rgba(0,0,0,.40);
      z-index:9999;
    }
    .modal-box{
      width:100%;
      max-width:560px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.35);
      background:#fff;
      box-shadow: 0 24px 80px rgba(0,0,0,.22);
      padding:14px;
    }
    .modal-title{
      font-weight:950; letter-spacing:-.2px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      margin-bottom:6px;
    }
    .modal-desc{color:rgba(17,24,39,.80); font-size:13px; line-height:1.55; margin-bottom:10px;}
    .modal-actions{display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;}
    .xbtn{
      border:1px solid rgba(17,24,39,.18);
      background:rgba(17,24,39,.03);
      border-radius:12px;
      padding:6px 10px;
      cursor:pointer;
      color:rgba(17,24,39,.78);
      font-weight:900;
    }

    footer{padding:10px 0 26px; color:rgba(17,24,39,.60); font-size:12px}

    @media print{
      body{background:white;color:black}
      header .topbar .btn,
      header .topbar .pill{display:none !important}
      .modal{display:none !important}
      .card{box-shadow:none}
      textarea{border:1px solid #aaa}
    }
  </style>
</head>

<body>
  <header class="container">
    <div class="brandbar">
      <div class="brand-left">
        <div class="brand-title">
          <div class="name">Law Office of Hong-min Jun</div>
          <div class="motto">Attorneys for foreign born individuals and small business owners!</div>
          <div class="licenses">Indiana Â· Illinois Attorney</div>
        </div>
      </div>
      <div class="brand-right">
        <span class="contact-pill"><span class="dot"></span><strong>askus@junlawfirm.com</strong></span>
        <span class="contact-pill">â˜ <strong>847-660-4233</strong></span>
        <span class="contact-pill">â˜ <strong>317-701-2768</strong></span>
      </div>
    </div>

    <div class="pagehead">
      <h1>NIW ì´ë‹ˆì…œ í‰ê°€ ë¶„ì„í‘œ <span class="tag">ê´€ë¦¬ììš©</span> <span class="tag">ì¼€ì´ìŠ¤ ë°œí–‰(Publish)</span></h1>
      <div class="subtitle">
        ì´ í˜ì´ì§€ëŠ” <strong>ë³€í˜¸ì‚¬ë‹˜ì´ ë‚´ë¶€ ë¶„ì„</strong>ì„ ì…ë ¥í•˜ê³ , ì¼€ì´ìŠ¤ë¥¼ Worker KVì— ì €ì¥í•œ ë’¤,
        ì˜ë¢°ì¸ì—ê²ŒëŠ” <strong>case.html ë§í¬</strong>ë¥¼ ë³´ë‚´ê¸° ìœ„í•œ ê´€ë¦¬ì í™”ë©´ì…ë‹ˆë‹¤.
      </div>

      <div class="formrow">
        <div class="field">
          <label for="clientName">ê³ ê°ëª… (Client Name) <span style="color:rgba(217,119,6,.95)">*</span></label>
          <input id="clientName" placeholder="ì˜ˆ: í™ê¸¸ë™" autocomplete="name" />
          <div class="hint">â€» ì¼€ì´ìŠ¤ ì €ì¥/ë°œí–‰ ì‹œ <strong>í•„ìˆ˜</strong>ì…ë‹ˆë‹¤.</div>
        </div>
        <div class="field">
          <label for="clientEmail">ì´ë©”ì¼ (Email) <span style="color:rgba(217,119,6,.95)">*</span></label>
          <input id="clientEmail" placeholder="ì˜ˆ: client@email.com" autocomplete="email" />
          <div class="hint">â€» ì¼€ì´ìŠ¤ ì €ì¥/ë°œí–‰ ì‹œ <strong>í•„ìˆ˜</strong>ì…ë‹ˆë‹¤.</div>
        </div>
        <div class="field">
          <label for="invoiceNo">Square Invoice ë²ˆí˜¸ (ì„ íƒ)</label>
          <input id="invoiceNo" placeholder="ì˜ˆ: INV-12345 ë˜ëŠ” Square Invoice ID" />
          <div class="hint">â€» ê²°ì œ ì¶”ì ìš©(ì„ íƒ)</div>
        </div>
      </div>

      <div class="topbar">
        <span class="pill">ì „ì²´ ì ìˆ˜: <strong id="totalScore">0</strong>/<span id="totalMax">0</span></span>
        <span class="pill">ìƒíƒœ: <span class="status"><span class="status-dot" id="statusDot"></span><span id="statusText">í‰ê°€ ì§„í–‰</span></span></span>

        <button class="btn" id="exportBtn" type="button">ğŸ“„ ê²°ê³¼ ë³µì‚¬</button>
        <button class="btn" type="button" onclick="window.print()">ğŸ–¨ ì¸ì‡„</button>
        <button class="btn danger" id="resetBtn" type="button">â†º ë¦¬ì…‹</button>

        <button class="btn gold" id="adminUnlockBtn" type="button">ğŸ”‘ ê´€ë¦¬ì ì…ë ¥ ì—´ê¸°</button>
        <button class="btn primary" id="publishBtn" type="button">ğŸš€ ì¼€ì´ìŠ¤ ë°œí–‰(Publish)</button>

        <span class="tiny">â€» PublishëŠ” Worker KVì— ì €ì¥ë©ë‹ˆë‹¤. ì˜ë¢°ì¸ì—ê²ŒëŠ” case.html ë§í¬ë¥¼ ë³´ë‚´ì„¸ìš”.</span>
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card summary">
      <div>
        <h2>ì¢…í•© ì´ˆê¸° íŒë‹¨ <span class="score" id="fitBadge">-</span></h2>

        <div class="kpi">
          <span class="pill">ì í•©ì„±: <strong id="fitLevel">-</strong></span>
          <span class="pill">ë³´ì™„ í›„ ê°€ëŠ¥ì„±: <strong id="improveLevel">-</strong></span>
          <span class="pill">EB-1 ì „í™˜: <strong id="eb1Level">-</strong></span>
          <span class="pill">ì „ëµì  ì ‘ê·¼: <strong id="strategyNeed">-</strong></span>
        </div>

        <div class="result" id="autoResult">ì²´í¬ë¥¼ ì§„í–‰í•˜ë©´ ìë™ ìš”ì•½ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</div>

        <div class="divider"></div>

        <label class="subtitle" for="overallNote" style="display:block;margin-top:4px;">
          ì´í‰ ë©”ëª¨(ë¬´ë£Œ ê³µê°œ ì˜ì—­ / ì˜ë¢°ì¸ì—ê²Œ ë³´ì—¬ì¤„ ìš”ì•½):
        </label>
        <textarea id="overallNote" placeholder="ì˜ˆ) í•µì‹¬ ê°•ì  / ê°€ì¥ í° ë¦¬ìŠ¤í¬ / ë³´ì™„ ê³„íš ìš”ì•½"></textarea>

        <div class="tiny" style="margin-top:8px;">
          ìš´ì˜ êµ¬ì¡°: ë¬´ë£Œ=ì ìˆ˜/ìš”ì•½ ì œê³µ â†’ ìœ ë£Œ=ì „ëµ ë©”ëª¨ + ë³´ì™„ ì²´í¬ë¦¬ìŠ¤íŠ¸(ì¦ê±° ìš°ì„ ìˆœìœ„/ì¶”ì²œì„œ ë°©í–¥)
        </div>
      </div>

      <div>
        <h2>ìœ ë£Œ ë‚´ìš© ì…ë ¥(ê´€ë¦¬ì ì „ìš©) <span class="score" id="adminState">CLOSED</span></h2>
        <div class="tiny" style="margin-top:-4px;">â€» ?admin=1 + ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸(ADMIN_SECRET)ë¡œ ì—´ë¦½ë‹ˆë‹¤.</div>

        <div style="margin-top:10px" id="adminEditor" hidden>
          <div class="badge">1) ì „ëµ ë©”ëª¨(ìœ ë£Œ) - HTML í—ˆìš©</div>
          <textarea id="paidStrategyInput" placeholder="ì—¬ê¸°ì— ì‚¬ê±´ë³„ ìœ ë£Œ ì „ëµ ë©”ëª¨ë¥¼ ì…ë ¥/ë¶™ì—¬ë„£ê¸°(HTML ê°€ëŠ¥)"></textarea>

          <div style="height:10px"></div>
          <div class="badge">2) ë³´ì™„ ì²´í¬ë¦¬ìŠ¤íŠ¸(ìœ ë£Œ) - HTML í—ˆìš©</div>
          <textarea id="paidChecklistInput" placeholder="ì—¬ê¸°ì— ì‚¬ê±´ë³„ ìœ ë£Œ ë³´ì™„ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¥¼ ì…ë ¥/ë¶™ì—¬ë„£ê¸°(HTML ê°€ëŠ¥)"></textarea>

          <div class="tiny" style="margin-top:8px;">
            * Publish ì‹œ Worker KV(CASES)ì— í•¨ê»˜ ì €ì¥ë©ë‹ˆë‹¤. ì˜ë¢°ì¸ì€ Unlock Codeë¡œë§Œ ì—´ëŒí•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </section>

    <section class="grid" id="sections"></section>

    <footer>
      <div style="margin-top:10px">
        Â© Law Office of Hong-min Jun. This tool provides an initial evaluation framework and does not constitute legal advice.
      </div>
    </footer>
  </main>

  <!-- Popup Modal -->
  <div class="modal" id="modal">
    <div class="modal-box">
      <div class="modal-title">
        <span id="modalTitle">ì•ˆë‚´</span>
        <button class="xbtn" id="modalClose">ë‹«ê¸°</button>
      </div>
      <div class="modal-desc" id="modalDesc">-</div>
      <div class="modal-actions">
        <button class="btn" id="modalOk">í™•ì¸</button>
      </div>
    </div>
  </div>

<script>
  // =========================================================
  // 0) Worker URL (ë³¸ì¸ Worker URLë¡œ ì„¤ì •)
  // =========================================================
  const WORKER_BASE_URL = "https://rough-thunder-0931.junlawfirm.workers.dev";

  // =========================================================
  // 1) ë¶„ì„í‘œ ë°ì´í„°(ë¬¸í•­/íƒ€ì´í‹€ì€ ê·¸ëŒ€ë¡œ ìœ ì§€)
  // =========================================================
  const DATA = [
    { id:"sec1", title:"1) ê¸°ë³¸ ìê²© ìš”ê±´ (Threshold Eligibility)", items:[
      { text:"ì„ì‚¬ ì´ìƒ í•™ìœ„ ë³´ìœ ", memo:"(ìœ ë£Œ ë©”ëª¨ëŠ” ì¼€ì´ìŠ¤ ì €ì¥ìš©ì´ ì•„ë‹ˆë¼, ì„¹ì…˜ë³„ ê¸°ë³¸ ê°€ì´ë“œë¡œë§Œ ì‚¬ìš©í•˜ë ¤ë©´ case.html ìª½ì—ì„œ í™œìš© ê°€ëŠ¥)", defaultChecked:true },
      { text:"í•™ì‚¬ + 5ë…„ ì´ìƒ ì ì§„ì  ê²½ë ¥", memo:"", defaultChecked:false },
      { text:"ì˜ˆì™¸ì  ëŠ¥ë ¥(EB-2) ì£¼ì¥ ê°€ëŠ¥", memo:"", defaultChecked:true },
    ]},
    { id:"sec2", title:"2) Proposed Endeavor ëª…í™•ì„±", items:[
      { text:"Endeavorê°€ êµ¬ì²´ì ìœ¼ë¡œ ì •ì˜ë¨", memo:"", defaultChecked:true },
      { text:"ë‹¨ìˆœ ê³„íšÂ·í¬ë§ì´ ì•„ë‹˜", memo:"", defaultChecked:true },
      { text:"ê³¼ê±° ì„±ê³¼ â†’ ë¯¸ë˜ ê¸°ì—¬ ì—°ê²°", memo:"", defaultChecked:true },
      { text:"ë¯¸êµ­ ë‚´ ìˆ˜í–‰ ê°€ëŠ¥ì„±(í™˜ê²½/í˜‘ì—…)", memo:"", defaultChecked:true },
    ]},
    { id:"sec3", title:"3) National Importance (êµ­ê°€ì  ì¤‘ìš”ì„±)", items:[
      { text:"ì‚°ì—…/ì‚¬íšŒì  ë¬¸ì œì™€ ì§ì ‘ ì—°ê²°", memo:"", defaultChecked:true },
      { text:"ì§€ì—­ í•œì •ì´ ì•„ë‹Œ íŒŒê¸‰íš¨ê³¼", memo:"", defaultChecked:true },
      { text:"ì •ì±…Â·ì•ˆì „Â·ìœ¤ë¦¬ ë“± ê³µê³µì„± ìš”ì†Œ", memo:"", defaultChecked:true },
      { text:"â€˜ì¤‘ìš” ì‚°ì—… ì¼ë°˜ë¡ â€™ì— ë¨¸ë¬¼ì§€ ì•ŠìŒ", memo:"", defaultChecked:true },
    ]},
    { id:"sec4", title:"4) ì „ë¬¸ì„± ë° ë…ìì„±", items:[
      { text:"í•´ë‹¹ ë¶„ì•¼ ì „ë¬¸ ê²½ë ¥", memo:"", defaultChecked:true },
      { text:"ìœ ì‚¬ ì „ë¬¸ê°€ ëŒ€ë¹„ ì°¨ë³„ì ", memo:"", defaultChecked:true },
      { text:"í•™ìœ„ ì™¸ ì „ë¬¸ì„± ì¦ê±°(êµ¬í˜„/ì§€í‘œ/íˆ´)", memo:"", defaultChecked:true },
      { text:"ëŒ€ì²´ ê°€ëŠ¥ì„± ë‚®ìŒ(í¬ì†Œí•œ ê²°í•©ì—­ëŸ‰)", memo:"", defaultChecked:true },
    ]},
    { id:"sec5", title:"5) ê³¼ê±° ì„±ê³¼ì˜ ì¦ê±°ë ¥", items:[
      { text:"ë™ë£Œí‰ê°€ ë…¼ë¬¸/í”„ë¡œì‹œë”©", memo:"", defaultChecked:true },
      { text:"ì—°êµ¬ ì‚°ì¶œ(í”„ë¡œí† íƒ€ì…/ì½”ë“œ/íˆ´í‚·)", memo:"", defaultChecked:true },
      { text:"ë°œí‘œ/ì´ˆì²­/íŒ¨ë„ ë“± ì™¸ë¶€ ê²€ì¦", memo:"", defaultChecked:true },
      { text:"ì—°êµ¬ í”„ë¡œê·¸ë¨(ë¡œë“œë§µ) ì¼ê´€ì„±", memo:"", defaultChecked:true },
    ]},
    { id:"sec6", title:"6) ì¶”ì²œì„œ ì „ëµ", items:[
      { text:"ë…ë¦½ ì¶”ì²œì¸ í™•ë³´(ì´í•´ê´€ê³„ ìµœì†Œ)", memo:"", defaultChecked:true },
      { text:"ì „ë¬¸ì„± ì§ì ‘ ê²€ì¦ ê°€ëŠ¥í•œ ì¶”ì²œì¸", memo:"", defaultChecked:true },
      { text:"Endeavorì™€ ì •í™•íˆ ì—°ê²°", memo:"", defaultChecked:true },
      { text:"í˜•ì‹ì  í‘œí˜„ ìµœì†Œí™”(êµ¬ì²´ì„±)", memo:"", defaultChecked:true },
    ]},
    { id:"sec7", title:"7) 3rd Prong (Labor Cert ë©´ì œ íƒ€ë‹¹ì„±)", items:[
      { text:"ê³ ìš©ì£¼ íŠ¹ì • ì—†ì´ë„ ìˆ˜í–‰ ê°€ëŠ¥", memo:"", defaultChecked:true },
      { text:"Labor Certë¡œ ê³µìµ ì‹¤í˜„ì´ ì§€ì—°/ì œí•œ", memo:"", defaultChecked:true },
      { text:"ê°œì¸ ì—­ëŸ‰ ì¤‘ì‹¬ì˜ ê³µìµ ë…¼ë¦¬", memo:"", defaultChecked:true },
      { text:"ë¯¸êµ­ì— ë” í° ì´ìµ(ë¹„êµ ë…¼ë¦¬ í¬í•¨)", memo:"", defaultChecked:true },
    ]},
    { id:"sec8", title:"8) ë¦¬ìŠ¤í¬ ìš”ì†Œ ì ê²€", items:[
      { text:"Endeavorê°€ ê³¼ë„í•˜ê²Œ ì¶”ìƒì ì´ì§€ ì•ŠìŒ", memo:"", defaultChecked:true },
      { text:"ë¯¸ë˜ ê³„íšë§Œ ê°•ì¡°í•˜ì§€ ì•ŠìŒ", memo:"", defaultChecked:true },
      { text:"â€˜ë¹„ì£¼ë¥˜â€™ë¥¼ â€˜ì„ êµ¬ì  ì—°êµ¬ í”„ë¡œê·¸ë¨â€™ìœ¼ë¡œ ì •ì œ", memo:"", defaultChecked:true },
      { text:"ë…¼ë¬¸ ìˆ˜ ê³µê²© ëŒ€ë¹„(ì§ˆÂ·ì™¸ë¶€ê²€ì¦)", memo:"", defaultChecked:true },
    ]},
  ];

  const sectionsEl = document.getElementById("sections");

  function escapeHtml(s){
    return String(s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function render(){
    sectionsEl.innerHTML = "";
    for(const sec of DATA){
      const card = document.createElement("section");
      card.className = "card";
      card.id = sec.id;

      const max = sec.items.length;
      const header = document.createElement("h2");
      header.innerHTML = `${sec.title} <span class="score" id="${sec.id}-score">0/${max}</span>`;
      card.appendChild(header);

      const table = document.createElement("table");
      table.innerHTML = `
        <thead>
          <tr>
            <th>í•­ëª©</th>
            <th>ì²´í¬</th>
            <th>ë©”ëª¨(ê´€ë¦¬ì ë‚´ë¶€ ì…ë ¥ì€ ìœ„ì—ì„œ ë³„ë„ ì €ì¥)</th>
          </tr>
        </thead>
      `;

      const tbody = document.createElement("tbody");
      sec.items.forEach((it, idx) => {
        const cbId = `${sec.id}-cb-${idx}`;
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${escapeHtml(it.text)}</td>
          <td><input type="checkbox" id="${cbId}"></td>
          <td>
            <div class="tiny" style="padding:6px 0 0;">
              ${it.memo ? escapeHtml(it.memo) : "â€”"}
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      card.appendChild(table);
      sectionsEl.appendChild(card);
    }

    DATA.forEach(sec=>{
      sec.items.forEach((it, idx)=>{
        const cb = document.getElementById(`${sec.id}-cb-${idx}`);
        cb.checked = !!it.defaultChecked;
        cb.addEventListener("change", updateAll);
      });
    });

    updateAll();
  }

  function sectionScore(secId){
    const sec = DATA.find(s=>s.id===secId);
    let checked = 0;
    sec.items.forEach((_, idx)=>{
      const cb = document.getElementById(`${secId}-cb-${idx}`);
      if(cb && cb.checked) checked++;
    });
    return {checked, max: sec.items.length};
  }

  function topSections(n){
    const arr = DATA.map(sec=>{
      const s = sectionScore(sec.id);
      return {title: sec.title, ratio: s.max? s.checked/s.max : 0};
    }).sort((a,b)=>b.ratio-a.ratio);
    return arr.slice(0,n).map(x=>x.title);
  }

  function bottomSections(n){
    const arr = DATA.map(sec=>{
      const s = sectionScore(sec.id);
      return {title: sec.title, ratio: s.max? s.checked/s.max : 0};
    }).sort((a,b)=>a.ratio-b.ratio);
    return arr.slice(0,n).map(x=>x.title);
  }

  function updateAll(){
    let totalChecked = 0;
    let totalMax = 0;

    for(const sec of DATA){
      const {checked, max} = sectionScore(sec.id);
      totalChecked += checked;
      totalMax += max;
      const badge = document.getElementById(`${sec.id}-score`);
      if(badge) badge.textContent = `${checked}/${max}`;
    }

    document.getElementById("totalScore").textContent = totalChecked;
    document.getElementById("totalMax").textContent = totalMax;

    const ratio = totalMax ? (totalChecked/totalMax) : 0;

    const statusDot = document.getElementById("statusDot");
    const statusText = document.getElementById("statusText");
    const fitBadge = document.getElementById("fitBadge");

    let status = "ë³´ì™„ í•„ìš”";
    let dot = "bad";
    let badge = "Needs work";

    if(ratio >= 0.85){ status = "ë§¤ìš° ê°•í•¨"; dot = "ok"; badge = "Strong"; }
    else if(ratio >= 0.65){ status = "ì¶©ë¶„íˆ ê°€ëŠ¥"; dot = ""; badge = "Viable"; }

    statusText.textContent = status;
    statusDot.className = "status-dot" + (dot==="ok" ? " ok" : dot==="bad" ? " bad" : "");
    fitBadge.textContent = badge;

    const fitLevel = document.getElementById("fitLevel");
    const improveLevel = document.getElementById("improveLevel");
    const eb1Level = document.getElementById("eb1Level");
    const strategyNeed = document.getElementById("strategyNeed");

    if(ratio >= 0.85){
      fitLevel.textContent = "ë§¤ìš° ë†’ìŒ";
      improveLevel.textContent = "ë†’ìŒ";
      eb1Level.textContent = "ì¤‘ì¥ê¸° ê²€í†  ê°€ëŠ¥";
      strategyNeed.textContent = "ì˜ˆ(ì„œìˆ Â·ì¶”ì²œì„œ)";
    } else if(ratio >= 0.65){
      fitLevel.textContent = "ë³´í†µ~ë†’ìŒ";
      improveLevel.textContent = "ë³´ì™„ ì‹œ ë†’ìŒ";
      eb1Level.textContent = "ì¶”ê°€ ì‹¤ì  í•„ìš”";
      strategyNeed.textContent = "ì˜ˆ";
    } else {
      fitLevel.textContent = "ë‚®ìŒ";
      improveLevel.textContent = "ë¶ˆí™•ì‹¤";
      eb1Level.textContent = "í˜„ ë‹¨ê³„ ì–´ë ¤ì›€";
      strategyNeed.textContent = "í•„ìˆ˜";
    }

    document.getElementById("autoResult").innerHTML = `
      í˜„ì¬ ì²´í¬ ì ìˆ˜ëŠ” <strong>${totalChecked}/${totalMax}</strong>ì…ë‹ˆë‹¤.<br>
      â€¢ ê°•ì (ìƒìœ„): ${topSections(3).join(", ")}<br>
      â€¢ ë³´ì™„ ìš°ì„ (í•˜ìœ„): ${bottomSections(2).join(", ")}<br>
      <div class="tiny" style="margin-top:6px;">
        â€» ìœ ë£Œ ì˜ì—­(ì „ëµ ë©”ëª¨/ì²´í¬ë¦¬ìŠ¤íŠ¸)ì€ ì¼€ì´ìŠ¤ë³„ë¡œ ìœ„ â€œê´€ë¦¬ì ì „ìš©â€ ì…ë ¥ë€ì— ì‘ì„±í•œ ë‚´ìš©ì´ ì €ì¥ë©ë‹ˆë‹¤.
      </div>
    `;
  }

  // =========================
  // Modal
  // =========================
  const modal = document.getElementById("modal");
  const modalTitle = document.getElementById("modalTitle");
  const modalDesc = document.getElementById("modalDesc");
  const modalClose = document.getElementById("modalClose");
  const modalOk = document.getElementById("modalOk");

  function showModal(title, desc){
    modalTitle.textContent = title;
    modalDesc.innerHTML = desc;
    modal.style.display = "flex";
  }
  function hideModal(){ modal.style.display = "none"; }
  modalClose.addEventListener("click", hideModal);
  modalOk.addEventListener("click", hideModal);
  modal.addEventListener("click", (e)=>{ if(e.target === modal) hideModal(); });

  // =========================================================
  // 2) ê´€ë¦¬ì ì…ë ¥ ì—´ê¸°: ?admin=1 + ADMIN_SECRET í•„ìš”(Workerì—ì„œ ê²€ì¦)
  // =========================================================
  const isAdminQuery = new URLSearchParams(location.search).get("admin") === "1";
  const ADMIN_SECRET_KEY = "junlawfirm_admin_secret_v1";

  function openAdminEditor(){
    if(!isAdminQuery){
      showModal("ê´€ë¦¬ì ëª¨ë“œ", "ì£¼ì†Œ ëì— <strong>?admin=1</strong>ì„ ë¶™ì—¬ ì ‘ì†í•˜ì„¸ìš”. ì˜ˆ) index.html?admin=1");
      return;
    }
    const saved = sessionStorage.getItem(ADMIN_SECRET_KEY) || "";
    const v = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸(ADMIN_SECRET)ë¥¼ ì…ë ¥í•˜ì„¸ìš”:", saved);
    if(!v) return;
    sessionStorage.setItem(ADMIN_SECRET_KEY, v.trim());

    document.getElementById("adminEditor").hidden = false;
    document.getElementById("adminState").textContent = "OPEN";
    showModal("ê´€ë¦¬ì ì…ë ¥ í™œì„±í™”", "ìœ ë£Œ ë‚´ìš© ì…ë ¥ë€ì´ ì—´ë ¸ìŠµë‹ˆë‹¤. ì‘ì„± í›„ <strong>Publish</strong>ë¥¼ ëˆ„ë¥´ì„¸ìš”.");
  }

  document.getElementById("adminUnlockBtn").addEventListener("click", openAdminEditor);

  // =========================================================
  // 3) í•„ìˆ˜ê°’ ê²€ì‚¬
  // =========================================================
  function validateRequiredClientFields(){
    const name = (document.getElementById("clientName").value || "").trim();
    const email = (document.getElementById("clientEmail").value || "").trim();

    if(!name){
      showModal("ì…ë ¥ í•„ìš”", "<strong>ê³ ê°ëª…</strong>ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      document.getElementById("clientName").focus();
      return false;
    }
    if(!email){
      showModal("ì…ë ¥ í•„ìš”", "<strong>ì´ë©”ì¼</strong>ì„ ë¨¼ì € ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      document.getElementById("clientEmail").focus();
      return false;
    }
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
      showModal("ì´ë©”ì¼ í™•ì¸", "ì´ë©”ì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•´ ì£¼ì„¸ìš”.");
      document.getElementById("clientEmail").focus();
      return false;
    }
    return true;
  }

  // =========================================================
  // 4) ë‚´ë³´ë‚´ê¸°(í´ë¦½ë³´ë“œ)
  // =========================================================
  document.getElementById("exportBtn").addEventListener("click", ()=>{
    const totalChecked = Number(document.getElementById("totalScore").textContent || 0);
    const totalMax = Number(document.getElementById("totalMax").textContent || 0);

    const name = (document.getElementById("clientName").value || "").trim();
    const email = (document.getElementById("clientEmail").value || "").trim();
    const inv = (document.getElementById("invoiceNo").value || "").trim();

    const status = document.getElementById("statusText").textContent;
    const note = (document.getElementById("overallNote").value || "").trim();

    let lines = [];
    lines.push("Law Office of Hong-min Jun | NIW ì´ë‹ˆì…œ í‰ê°€(ê´€ë¦¬ì) ê²°ê³¼");
    lines.push(`- ê³ ê°ëª…: ${name || "(ë¯¸ì…ë ¥)"}`);
    lines.push(`- ì´ë©”ì¼: ${email || "(ë¯¸ì…ë ¥)"}`);
    lines.push(`- Square Invoice ë²ˆí˜¸: ${inv || "(ë¯¸ì…ë ¥)"}`);
    lines.push("");
    lines.push(`- ì „ì²´ ì ìˆ˜: ${totalChecked}/${totalMax}`);
    lines.push(`- ìƒíƒœ: ${status}`);
    lines.push(`- ì í•©ì„±: ${document.getElementById("fitLevel").textContent}`);
    lines.push(`- ë³´ì™„ í›„ ê°€ëŠ¥ì„±: ${document.getElementById("improveLevel").textContent}`);
    lines.push(`- EB-1 ì „í™˜: ${document.getElementById("eb1Level").textContent}`);
    lines.push(`- ì „ëµì  ì ‘ê·¼: ${document.getElementById("strategyNeed").textContent}`);
    lines.push("");
    lines.push("ì„¹ì…˜ë³„ ì ìˆ˜:");
    DATA.forEach(sec=>{
      const s = sectionScore(sec.id);
      lines.push(`- ${sec.title}: ${s.checked}/${s.max}`);
    });
    if(note){
      lines.push("");
      lines.push("ì´í‰ ë©”ëª¨(ë¬´ë£Œ ê³µê°œ):");
      lines.push(note);
    }

    const text = lines.join("\n");
    navigator.clipboard?.writeText(text).then(()=>{
      showModal("ë³µì‚¬ ì™„ë£Œ", "ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }).catch(()=>{
      prompt("ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”:", text);
    });
  });

  // =========================================================
  // 5) ë¦¬ì…‹
  // =========================================================
  document.getElementById("resetBtn").addEventListener("click", ()=>{
    DATA.forEach(sec=>{
      sec.items.forEach((it, idx)=>{
        const cb = document.getElementById(`${sec.id}-cb-${idx}`);
        if(cb) cb.checked = !!it.defaultChecked;
      });
    });
    document.getElementById("overallNote").value = "";
    document.getElementById("paidStrategyInput").value = "";
    document.getElementById("paidChecklistInput").value = "";

    updateAll();
    showModal("ë¦¬ì…‹ ì™„ë£Œ", "ì²´í¬/ë©”ëª¨ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
  });

  // =========================================================
  // 6) Publish: Worker KV(CASES)ì— ì €ì¥
  //    - ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ëŠ” header: X-Admin-Secret
  // =========================================================
  function collectCaseData(){
    const sections = DATA.map(sec=>{
      const items = sec.items.map((it, idx)=>{
        const cb = document.getElementById(`${sec.id}-cb-${idx}`);
        return {
          text: it.text,
          checked: !!(cb && cb.checked)
        };
      });
      const s = sectionScore(sec.id);
      return { id: sec.id, title: sec.title, score: s, items };
    });

    const totalChecked = Number(document.getElementById("totalScore").textContent || 0);
    const totalMax = Number(document.getElementById("totalMax").textContent || 0);
    const status = document.getElementById("statusText").textContent;

    return {
      summary: {
        totalChecked, totalMax, status,
        fitLevel: document.getElementById("fitLevel").textContent,
        improveLevel: document.getElementById("improveLevel").textContent,
        eb1Level: document.getElementById("eb1Level").textContent,
        strategyNeed: document.getElementById("strategyNeed").textContent,
        autoResultHtml: document.getElementById("autoResult").innerHTML
      },
      sections,
      overallNote: (document.getElementById("overallNote").value || "").trim()
    };
  }

  async function publishCase(){
    if(!validateRequiredClientFields()) return;

    const name = (document.getElementById("clientName").value || "").trim();
    const email = (document.getElementById("clientEmail").value || "").trim();
    const inv = (document.getElementById("invoiceNo").value || "").trim();

    const adminSecret = (sessionStorage.getItem(ADMIN_SECRET_KEY) || "").trim();
    if(!adminSecret){
      showModal("ê´€ë¦¬ì ì¸ì¦ í•„ìš”", "ë¨¼ì € <strong>ê´€ë¦¬ì ì…ë ¥ ì—´ê¸°</strong>ì—ì„œ ADMIN_SECRETë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
      return;
    }

    const paidContent = {
      strategyMemoHtml: (document.getElementById("paidStrategyInput").value || "").trim(),
      checklistHtml: (document.getElementById("paidChecklistInput").value || "").trim()
    };

    const caseData = collectCaseData();

    try{
      const resp = await fetch(`${WORKER_BASE_URL}/publish`, {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "X-Admin-Secret": adminSecret
        },
        body: JSON.stringify({
          clientName: name,
          clientEmail: email,
          invoiceNo: inv,
          caseData,
          paidContent
        })
      });

      const data = await resp.json().catch(()=>({}));
      if(!data.ok){
        showModal("Publish ì‹¤íŒ¨", escapeHtml(data.error || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"));
        return;
      }

      const caseId = data.caseId;
      const caseUrl = data.caseUrl; // workerê°€ ë§Œë“¤ì–´ì¤Œ
      showModal(
        "Publish ì„±ê³µ",
        `ì¼€ì´ìŠ¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.<br><br>
         <strong>ì˜ë¢°ì¸ ë§í¬</strong><br>
         <div class="paid" style="margin-top:8px;">
           ${escapeHtml(caseUrl)}
         </div>
         (case.htmlì— ìë™ìœ¼ë¡œ ì—°ê²°ë˜ëŠ” ì£¼ì†Œì…ë‹ˆë‹¤)`
      );

    }catch(e){
      showModal("ì„œë²„ ì—°ê²° ì˜¤ë¥˜", "Workerì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. WORKER_BASE_URLê³¼ CORS ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
    }
  }

  document.getElementById("publishBtn").addEventListener("click", publishCase);

  // Init
  render();
  updateAll();
</script>
</body>
</html>
